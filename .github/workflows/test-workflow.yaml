name: Greet Everyone
# This workflow is triggered on pushes to the repository.
on: [push]

# Environment variables available to all jobs and steps in this workflow
env:
  GKE_PROJECT: ${{ secrets.GKE_PROJECT }}
  GKE_EMAIL: ${{ secrets.GKE_EMAIL }}
  GITHUB_SHA: ${{ github.sha }}
  GKE_ZONE: us-west1-a
  GKE_CLUSTER: example-gke-cluster
  IMAGE: gke-test

jobs:
  build:
    # Job name is Greeting
    name: Greeting
    # This job runs on Linux
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository
      - name: Checkout
        uses: actions/checkout@v1    
      # This step uses GitHub's hello-world-javascript-action: https://github.com/actions/hello-world-javascript-action
      - name: Hello world
        uses: actions/hello-world-javascript-action@v1
        with:
          who-to-greet: 'Mona the Octocat'
        id: hello
      # Set up kops
      - name: Set up kops
        run: |
          curl -o kops --location https://github.com/kubernetes/kops/releases/download/1.13.2/kops-linux-amd64
          chmod u+x ./kops
          export PATH=$(pwd):$PATH
          kops version
      # This step prints an output (time) from the previous step's action.
      - name: Echo the greeting's time
        run: |
          export PATH=$(pwd):$PATH
          echo 'The time was ${{ steps.hello.outputs.time }}.'
          ls -l
          cd ./clusters/aws/kops
          ls -l
          kops version
          ./kops.sh --name dev-ex --update true --dry-run false
